<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Complet - Hybrid Master</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 10px;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
        .test-item {
            background: #333;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 5px solid #666;
        }
        .success { border-left-color: #4CAF50; }
        .error { border-left-color: #f44336; }
        .loading { border-left-color: #ff9800; }
        button {
            padding: 12px 24px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #1976D2;
        }
        .progress {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: #4CAF50;
            width: 0%;
            transition: width 0.3s;
        }
        .console {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Test Complet - Hybrid Master</h1>
            <p>Diagnostic de l'architecture compl√®te</p>
            <div class="progress">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <button onclick="runAllTests()">üöÄ Lancer tous les tests</button>
            <button onclick="downloadReport()">üìä T√©l√©charger rapport</button>
        </div>

        <div class="test-section">
            <h2>üì¶ Modules JavaScript</h2>
            <div id="modules-results"></div>
        </div>

        <div class="test-section">
            <h2>üåê √âl√©ments DOM</h2>
            <div id="dom-results"></div>
        </div>

        <div class="test-section">
            <h2>üìÅ Structure des fichiers</h2>
            <div id="files-results"></div>
        </div>

        <div class="test-section">
            <h2>üìü Console de test</h2>
            <div class="console" id="console"></div>
        </div>
    </div>

    <script>
        const testResults = {
            modules: [],
            dom: [],
            files: [],
            logs: []
        };

        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            const div = document.createElement('div');
            div.textContent = logEntry;
            div.style.color = type === 'error' ? '#ff4444' : 
                            type === 'success' ? '#44ff44' : 
                            type === 'warning' ? '#ffff44' : '#ffffff';
            console.appendChild(div);
            console.scrollTop = console.scrollHeight;
            
            testResults.logs.push({ timestamp, message, type });
        }

        function updateProgress(percent) {
            document.getElementById('progress-bar').style.width = percent + '%';
        }

        async function testFile(path) {
            return new Promise((resolve) => {
                fetch(path)
                    .then(response => {
                        resolve({
                            path: path,
                            exists: response.status === 200,
                            status: response.status
                        });
                    })
                    .catch(() => {
                        resolve({
                            path: path,
                            exists: false,
                            status: 404
                        });
                    });
            });
        }

        function testDOMElement(id) {
            const element = document.getElementById(id);
            return {
                id: id,
                exists: !!element,
                tagName: element ? element.tagName : 'N/A'
            };
        }

        function displayResult(containerId, result) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-item ${result.exists ? 'success' : 'error'}`;
            
            const status = result.exists ? '‚úÖ' : '‚ùå';
            const message = result.exists ? 'OK' : 'MANQUANT';
            
            div.innerHTML = `
                <strong>${status} ${result.path || '#' + result.id}</strong>
                <div style="margin-top: 5px; color: #ccc;">
                    ${result.exists ? 'Trouv√©' : 'Introuvable'}
                    ${result.solution ? `<br><small>Solution: ${result.solution}</small>` : ''}
                </div>
            `;
            
            container.appendChild(div);
        }

        async function testModules() {
            log('Test des modules JavaScript...', 'info');
            const modules = [
                './scripts/core/program-data.js',
                './scripts/ui/workout-renderer.js',
                './scripts/ui/navigation-ui.js',
                './scripts/modules/timer-manager.js',
                './scripts/modules/workout-session.js',
                './scripts/storage/local-storage.js'
            ];

            for (let i = 0; i < modules.length; i++) {
                const module = modules[i];
                const result = await testFile(module);
                testResults.modules.push(result);
                displayResult('modules-results', {
                    ...result,
                    solution: result.exists ? null : `Cr√©er le fichier: ${module}`
                });
                updateProgress((i + 1) / modules.length * 25);
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            log('Test des modules termin√©', 'success');
        }

        function testDOMElements() {
            log('Test des √©l√©ments DOM...', 'info');
            const elements = [
                'app', 'workout-container', 'week-display',
                'prev-week', 'next-week', 'timer-display',
                'timer-start', 'timer-reset'
            ];

            elements.forEach((element, index) => {
                const result = testDOMElement(element);
                testResults.dom.push(result);
                displayResult('dom-results', {
                    ...result,
                    solution: result.exists ? null : `Ajouter: &lt;div id="${element}"&gt;&lt;/div&gt;`
                });
                updateProgress(25 + ((index + 1) / elements.length * 25));
            });
            log('Test DOM termin√©', 'success');
        }

        async function testFileStructure() {
            log('Test de la structure des fichiers...', 'info');
            const files = [
                './index.html',
                './scripts/',
                './core/',
                './ui/',
                './modules/',
                './storage/'
            ];

            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const result = await testFile(file);
                testResults.files.push(result);
                displayResult('files-results', {
                    ...result,
                    solution: result.exists ? null : `Cr√©er le dossier/fichier: ${file}`
                });
                updateProgress(50 + ((i + 1) / files.length * 25));
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            log('Test structure termin√©', 'success');
        }

        async function runAllTests() {
            log('=== D√âMARRAGE DES TESTS COMPLETS ===', 'info');
            testResults.modules = [];
            testResults.dom = [];
            testResults.files = [];
            testResults.logs = [];
            
            document.getElementById('modules-results').innerHTML = '';
            document.getElementById('dom-results').innerHTML = '';
            document.getElementById('files-results').innerHTML = '';
            document.getElementById('console').innerHTML = '';
            
            updateProgress(0);

            try {
                await testModules();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                testDOMElements();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testFileStructure();
                
                updateProgress(100);
                log('=== TOUS LES TESTS TERMIN√âS ===', 'success');
                
                const totalTests = testResults.modules.length + testResults.dom.length + testResults.files.length;
                const passedTests = [...testResults.modules, ...testResults.dom, ...testResults.files]
                    .filter(test => test.exists).length;
                
                log(`R√©sum√©: ${passedTests}/${totalTests} tests r√©ussis`, 'info');
                
            } catch (error) {
                log('Erreur pendant les tests: ' + error.message, 'error');
            }
        }

        function downloadReport() {
            const report = {
                timestamp: new Date().toISOString(),
                results: testResults,
                summary: {
                    totalModules: testResults.modules.length,
                    workingModules: testResults.modules.filter(m => m.exists).length,
                    totalDomElements: testResults.dom.length,
                    foundDomElements: testResults.dom.filter(d => d.exists).length,
                    totalFiles: testResults.files.length,
                    existingFiles: testResults.files.filter(f => f.exists).length
                }
            };

            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `hybrid-master-test-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            log('Rapport t√©l√©charg√©', 'success');
        }

        // D√©marrer quelques tests automatiquement
        setTimeout(() => {
            log('Pr√™t √† tester - Cliquez sur "Lancer tous les tests"', 'info');
        }, 1000);
    </script>
</body>
</html>
